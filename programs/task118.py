def p(g,L=2):E=range;H=len(g);W=len(g[0]);R={(r,c)for r in E(H)for c in E(W)if g[r][c]&2};S=lambda Q,U:[Q and(S(Q[1:],U)or{1}>Q[0]&U and S(Q[1:],U|Q[0])),U][R<=U];return(U:=S([C for r in E(H)for c in E(W)for C in[{(y,x)for k in E(-L,L+1)for y,x in[(r+k,c),(r,c+k)]if H>y>-1<x<W}]if min(g[y][x]for y,x in C)&2],set()))and(exec('for r,c in U:g[r][c]+=3*(g[r][c]&1)')or g)or p(g,3)