def p(g):X=range;R=len(g);C=len(v:=g[0]);b=max(v,key=v.count);H=g,g[::-1];p,=[x for g in H for r in X(R-2)for c in X(C-2)if len(set(x:=[g[r+i//3][c+i%3]for i in X(9)]))>3>0<b!=x[0]!=x[8]!=b];[(W:=lambda a=b,b=b,c=b,*_:[a]*u+[b]*u+[c]*u)(W(p[0]),W(),W(c=p[8]))!=[g[r+q][f:=slice(c,[t:=c+3*u*s,None][t<0],s)]for q in X(3*u)]or exec('for q in X(3*u):g[r+q][f]=W(*p[q//u*3:])')for u in X(4)for s in[-1,1]for r in X(R-3*u+1)for c in X(C)for g in H];return g